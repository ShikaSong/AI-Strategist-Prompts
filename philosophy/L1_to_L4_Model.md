# L1-L4 记忆层级模型 (The Memory Hierarchy)

为了解决 LLM 的“金鱼脑”问题（Context Window 限制），Prometheus 设计了一套**从混乱到有序**的四层记忆过滤系统。

数据像水流一样，从 L1 流向 L4，体积逐层减小，价值逐层增加。

## 📊 层级详解

| 层级 | 名称 | 形态 | 更新频率 | 存储位置 | 作用 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **L1** | **感官流 (Sensory)** | 原始文本/JSON | 实时 | SQL (Logs) | 记录一切。包括心率数据、消费流水、聊天记录、任务状态。这是最底层的“矿石”。 |
| **L2** | **情景记忆 (Episodic)** | 结构化摘要 | 每日 | Vector DB | 对 L1 的叙事化总结。例如“2025年10月1日：用户因工作压力大导致失眠”。用于回答“昨天发生了什么”。 |
| **L3** | **语义记忆 (Semantic)** | 原子事实 (Atomic Facts) | 每日/周 | Vector DB | 从 L2 中剥离时间背景的客观事实。例如：“用户对咖啡因敏感”、“用户偏好极简主义设计”。**这是 RAG 检索的核心。** |
| **L4** | **核心画像 (Rules)** | 系统指令 (Instructions) | 不定期 | System Prompt | 基于 L3 归纳出的最高行为准则。例如：“禁止在周一上午安排会议”。直接注入到 LLM 的 System Prompt 中。 |

## 🔄 数据流转机制 (The Flow)

### L1 -> L2 (总结)
*   **触发器**: 3AM 协议。
*   **动作**: AI 阅读一天的 L1 日志，生成一份 `Daily Review`。

### L2 -> L3 (抽象)
*   **触发器**: 模式识别。
*   **动作**: 当 AI 发现某种模式（Pattern）反复出现（例如连续三天失眠），它会提取出一个 `Atomic Fact`。
*   **关键**: 包含证据链（Evidence Chain），链接回具体的 L1/L2 记录。

### L3 -> L4 (固化)
*   **触发器**: 权重阈值。
*   **动作**: 当一个 L3 事实的 `confidence`（置信度）和 `refer_count`（引用次数）极高时，它升级为 L4 规则，成为系统的本能。

---

## 🧩 为什么这样设计？

1.  **解决 Context 溢出**: 我们不需要把所有日志发给 AI，只需发送 L4 规则和相关的 L3 事实。
2.  **抗遗忘**: 即使是 5 年前的关键事实（L3），依然可以通过向量检索被唤醒。
3.  **可解释性**: 每一条 AI 的决策（L4），都能向下追溯到具体的经历（L1），建立了信任。
